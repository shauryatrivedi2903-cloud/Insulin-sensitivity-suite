<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Insulin Sensitivity Suite</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
:root{
  --bg:#f3f4f6;
  --card:#ffffff;
  --border:#e3e6eb;
  --text:#1f2937;
  --muted:#6b7280;
  --accent:#16827a;
  --ok:#198754;
  --warn:#d39e00;
  --risk:#dc3545;
  --badge-ok:#d1e7dd;
  --badge-warn:#fff3cd;
  --badge-risk:#f8d7da;
}
body{
  background:var(--bg);
  color:var(--text);
  font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,sans-serif;
}
.container-narrow{max-width:960px;}
.header-bar{
  background:linear-gradient(180deg,#fafafa 0%,#f1f3f6 100%);
  border:1px solid var(--border);
  border-radius:14px;
  padding:16px 18px;
  box-shadow:0 2px 6px rgba(0,0,0,.03);
}
.header-title{font-size:1.3rem;font-weight:700;margin:0;color:var(--accent);}
.header-sub{font-size:.92rem;color:var(--muted);}
.scroll-btn{
  background:var(--accent);
  color:#fff;
  border:none;
  font-weight:600;
  border-radius:999px;
  padding:.4rem .9rem;
  box-shadow:0 4px 12px rgba(22,130,122,.2);
  font-size:.9rem;
}
.ready-text{
  margin-left:.6rem;
  font-size:.9rem;
  font-style:italic;
  color:#4b635c;
  opacity:0;
  transition:opacity .2s ease;
}
.ready-text.show{opacity:1;}
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:14px;
  box-shadow:0 1px 4px rgba(0,0,0,.03);
}
.section-title{font-weight:700;color:var(--accent);margin-bottom:.5rem;}
.result-list{list-style:none;padding:0;margin:0;}
.result-list li{
  display:flex;
  justify-content:space-between;
  align-items:center;
  border:1px solid var(--border);
  border-radius:12px;
  padding:.6rem .8rem;
  margin:.4rem 0;
}
.label{font-weight:600;color:var(--accent);}
.value{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;}
.badge-int{
  font-size:.8rem;
  font-weight:600;
  border-radius:10px;
  padding:.2rem .6rem;
  color:#212529;
}
.ok{background:var(--badge-ok);color:var(--ok);}
.border{background:var(--badge-warn);color:var(--warn);}
.bad{background:var(--badge-risk);color:var(--risk);}
.footer-note{font-size:.85rem;color:var(--muted);}
.input-group-text{background:#eef2f7;border-color:var(--border);}
.form-control:focus{
  border-color:#8fd4ce;
  box-shadow:0 0 0 .2rem rgba(22,130,122,.15);
}

/* ---------- FINAL DUAL-DOT SYSTEM (no overlap, right side only) ---------- */
.form-label::before,
.form-label::after { content:none; }

/* ISI (red) → near text, via ::before */
.form-label.dot-red::before {
  content:"●";
  color:#dc3545;
  font-size:.85rem;
  margin-left:.35rem;
  vertical-align:middle;
  position:relative;
  top:-1px;
}

/* IGI/DI (blue) → farther right, via ::after */
.form-label.dot-blue::after {
  content:"●";
  color:#0d6efd;
  font-size:.85rem;
  margin-left:.65rem;
  vertical-align:middle;
  position:relative;
  top:-1px;
}

/* Toggle colors */
#enableISI.form-check-input:checked{background-color:#dc3545;border-color:#dc3545;}
#enableAdvanced.form-check-input:checked{background-color:#0d6efd;border-color:#0d6efd;}
#unitToggle.form-check-input:checked{background-color:var(--accent);border-color:var(--accent);}
</style>
</head>

<body>
<div class="container container-narrow my-3 my-sm-4">
  <div class="header-bar mb-3">
    <h1 class="header-title">Insulin Sensitivity Suite</h1>
    <div class="header-sub">
      HOMA-IR • HOMA-BETA • QUICKI • Matsuda • ISI(0,120) • IGI • DI
    </div>
  </div>
    <!-- Fasting Section -->
  <div class="card p-3 p-sm-4 mb-3">
    <div class="d-flex align-items-center justify-content-between flex-wrap">
      <div class="section-title mb-2 mb-sm-0">Fasting Values</div>
      <div class="d-flex align-items-center">
        <button id="scrollResults" class="scroll-btn">Scroll to Results ↓</button>
        <span id="readyText" class="ready-text">HOMA-IR, HOMA-β & QUICKI ready</span>
      </div>
    </div>

    <div class="row g-3 mt-1">
      <div class="col-12 col-sm-6">
        <label for="fg" class="form-label">Fasting glucose</label>
        <div class="input-group">
          <input id="fg" type="number" class="form-control" inputmode="decimal" placeholder="e.g. 92">
          <span id="glucoseUnit" class="input-group-text">mg/dL</span>
        </div>
      </div>
      <div class="col-12 col-sm-6">
        <label for="fi" class="form-label">Fasting insulin</label>
        <div class="input-group">
          <input id="fi" type="number" class="form-control" inputmode="decimal" placeholder="e.g. 10">
          <span id="insulinUnit" class="input-group-text">µU/mL</span>
        </div>
      </div>
    </div>

    <div class="form-check form-switch mt-3">
      <input class="form-check-input" type="checkbox" id="unitToggle">
      <label class="form-check-label" for="unitToggle">
        Use mmol/L &amp; pmol/L units
      </label>
    </div>
  </div>

  <!-- OGTT Section -->
  <div class="card p-3 p-sm-4 mb-3">
    <div class="d-flex justify-content-between align-items-center mb-2 flex-wrap">
      <div class="section-title mb-0">OGTT Values (for Matsuda Index)</div>
      <div class="d-flex gap-2">
        <button id="copyFasting" class="btn btn-sm btn-outline-secondary">
          Copy fasting → 0′
        </button>
        <button id="clearOGTT" class="btn btn-sm btn-outline-secondary">
          Clear OGTT
        </button>
      </div>
    </div>

    <!-- ISI + IGI toggles -->
    <div class="form-check form-switch mb-3">
      <input class="form-check-input" type="checkbox" id="enableISI">
      <label class="form-check-label" for="enableISI">
        Enable ISI (0,120) calculation
      </label>
    </div>
    <div class="form-check form-switch mb-3">
      <input class="form-check-input" type="checkbox" id="enableAdvanced">
      <label class="form-check-label" for="enableAdvanced">
        Show advanced indices (IGI &amp; DI)
      </label>
    </div>

    <!-- OGTT table -->
    <div class="row g-3">
      <div class="col-6 col-md-3">
        <label for="g0" class="form-label">Glucose 0′</label>
        <input id="g0" type="number" class="form-control" inputmode="decimal">
      </div>
      <div class="col-6 col-md-3">
        <label for="i0" class="form-label">Insulin 0′</label>
        <input id="i0" type="number" class="form-control" inputmode="decimal">
      </div>
      <div class="col-6 col-md-3">
        <label for="g30" class="form-label">Glucose 30′</label>
        <input id="g30" type="number" class="form-control" inputmode="decimal">
      </div>
      <div class="col-6 col-md-3">
        <label for="i30" class="form-label">Insulin 30′</label>
        <input id="i30" type="number" class="form-control" inputmode="decimal">
      </div>
      <div class="col-6 col-md-3">
        <label for="g60" class="form-label">Glucose 60′</label>
        <input id="g60" type="number" class="form-control" inputmode="decimal">
      </div>
      <div class="col-6 col-md-3">
        <label for="i60" class="form-label">Insulin 60′</label>
        <input id="i60" type="number" class="form-control" inputmode="decimal">
      </div>
      <div class="col-6 col-md-3">
        <label for="g90" class="form-label">Glucose 90′</label>
        <input id="g90" type="number" class="form-control" inputmode="decimal">
      </div>
      <div class="col-6 col-md-3">
        <label for="i90" class="form-label">Insulin 90′</label>
        <input id="i90" type="number" class="form-control" inputmode="decimal">
      </div>
      <div class="col-6 col-md-3">
        <label for="g120" class="form-label">Glucose 120′</label>
        <input id="g120" type="number" class="form-control" inputmode="decimal">
      </div>
      <div class="col-6 col-md-3">
        <label for="i120" class="form-label">Insulin 120′</label>
        <input id="i120" type="number" class="form-control" inputmode="decimal">
      </div>
    </div>
  </div>
    <!-- Results -->
  <div id="results" class="card p-3 p-sm-4 mb-3">
    <div class="section-title">Results &amp; Interpretation</div>
    <ul id="resultList" class="result-list"></ul>
    <button id="pdfBtn" class="btn btn-outline-secondary mt-2">
      Download PDF Report
    </button>
  </div>

  <!-- Reference Formulas and Basic Information -->
  <div class="card p-3 p-sm-4 mb-3">
    <button class="btn btn-sm btn-outline-secondary mb-2"
            data-bs-toggle="collapse" data-bs-target="#refSection">
      Show Reference Formulas &amp; Basic Information
    </button>
    <div class="collapse" id="refSection">
      <ul class="mb-0 small">
        <li>
          <strong>HOMA-IR</strong> = (Glucose × Insulin) / 405  &lt; 2 Normal • 2–2.5 Borderline • &gt; 2.5 Resistant  
          <br><em>Matthews DR et al., Diabetologia 1985 28: 412-419</em>
        </li>

        <li class="mt-2">
          <strong>HOMA-BETA</strong> = (20 × Insulin)/(Glucose − 3.5)  60–140 % Normal • &lt; 60 % Low • &gt; 140 % High  
          <br><em>Matthews DR et al., Diabetologia 1985 28: 412-419</em>
        </li>

        <li class="mt-2">
          <strong>QUICKI</strong> = 1 / [log(Insulin)+log(Glucose)]  &gt; 0.33 Normal • 0.30–0.33 Borderline • &lt; 0.30 Resistant  
          <br><em>Katz A et al., J Clin Endocrinol Metab 2000 85: 2402-2410</em>
        </li>

        <li class="mt-2">
          <strong>Matsuda Index</strong> = 10000 / √(FPG × FPI × Mean G × Mean I)  &gt; 4 Normal • 2.5–4 Impaired • &lt; 2.5 Resistant  
          <br><em>Matsuda M &amp; DeFronzo RA, Diabetes Care 1999 22: 1462-1470</em>
        </li>

        <li class="mt-2">
          <strong>ISI (0,120)</strong> = 10000 / √(G₀ × I₀ × G₁₂₀ × I₁₂₀)  &gt; 4.3 Normal • 2.9–4.3 Impaired • &lt; 2.9 Resistant  
          <br><em>Adapted from Matsuda &amp; DeFronzo 1999</em>
        </li>

        <li class="mt-2">
          <strong>Insulinogenic Index (IGI)</strong> = (Ins₃₀ − Ins₀)/(Gluc₃₀ − Gluc₀)  Higher = better early β-cell response  
          <br><em>Kosaka K et al., Diabetes 1970 19: 188-192</em>
        </li>

        <li class="mt-2">
          <strong>Disposition Index (DI)</strong> = IGI × Matsuda Index  Composite β-cell compensation for sensitivity  
          <br><em>Kahn SE, Diabetologia 2003 46: 3-19</em>
        </li>
      </ul>
    </div>
  </div>

  <!-- Collapsible Disclaimer -->
  <div class="text-center mt-3 mb-2">
    <button class="btn btn-sm btn-outline-secondary"
            data-bs-toggle="collapse" data-bs-target="#legalNotice">
      Disclaimer
    </button>
    <div class="collapse mt-2" id="legalNotice">
      <p class="small text-muted mx-auto" style="max-width:700px;">
        This calculator is for educational and research use only. It does not store data and must not be used for clinical diagnosis or therapy decisions.
      </p>
    </div>
  </div>

  <p class="footer-note text-center mt-2">
    © 2025 Shaurya Trivedi · Insulin Sensitivity Suite · No data stored.
  </p>
</div>
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
(function(){
const fg=document.getElementById('fg'), fi=document.getElementById('fi');
const readyText=document.getElementById('readyText');
const glucoseUnit=document.getElementById('glucoseUnit'), insulinUnit=document.getElementById('insulinUnit');
const unitToggle=document.getElementById('unitToggle');
const gEls=['g0','g30','g60','g90','g120'].map(id=>document.getElementById(id));
const iEls=['i0','i30','i60','i90','i120'].map(id=>document.getElementById(id));
const enableISI=document.getElementById('enableISI'), enableAdvanced=document.getElementById('enableAdvanced');
const list=document.getElementById('resultList'), scrollBtn=document.getElementById('scrollResults');
let mmol=false;
const val=e=>parseFloat(e.value)||null, pos=v=>v&&v>0;

/* ---------- Unit toggle ---------- */
unitToggle.addEventListener('change',()=>{
  mmol=unitToggle.checked;
  if(mmol){
    if(fg.value) fg.value=(parseFloat(fg.value)/18).toFixed(2);
    if(fi.value) fi.value=(parseFloat(fi.value)*6).toFixed(2);
    glucoseUnit.textContent='mmol/L'; insulinUnit.textContent='pmol/L';
  } else {
    if(fg.value) fg.value=(parseFloat(fg.value)*18).toFixed(0);
    if(fi.value) fi.value=(parseFloat(fi.value)/6).toFixed(2);
    glucoseUnit.textContent='mg/dL'; insulinUnit.textContent='µU/mL';
  }
  compute(); checkReady();
});

/* ---------- Interpretation helpers ---------- */
const sHOMAIR=v=>!pos(v)?{t:'—',c:''}:v<2?{t:'Normal',c:'ok'}:v<=2.5?{t:'Borderline',c:'border'}:{t:'Resistant',c:'bad'};
const sHOMAB=v=>!pos(v)?{t:'—',c:''}:v<60?{t:'Low',c:'bad'}:v<=140?{t:'Normal',c:'ok'}:{t:'High',c:'border'};
const sQUICKI=v=>!pos(v)?{t:'—',c:''}:v>0.33?{t:'Normal',c:'ok'}:v>=0.30?{t:'Borderline',c:'border'}:{t:'Resistant',c:'bad'};
const sMatsuda=v=>!pos(v)?{t:'—',c:''}:v>4?{t:'Normal',c:'ok'}:v>=2.5?{t:'Impaired',c:'border'}:{t:'Resistant',c:'bad'};
const sISI=v=>!pos(v)?{t:'—',c:''}:v>4.3?{t:'Normal',c:'ok'}:v>=2.9?{t:'Impaired',c:'border'}:{t:'Resistant',c:'bad'};

/* ---------- Compute ---------- */
function makeRow(lbl,vtxt,st){
  const li=document.createElement('li');
  li.innerHTML=`<span class="label">${lbl}</span>
  <span><span class="value">${vtxt}</span>
  <span class="badge-int ${st.c}">${st.t}</span></span>`;
  list.appendChild(li);
}

function compute(){
  list.innerHTML='';
  let g=val(fg), i=val(fi);
  if(mmol){ g=g?g*18:g; i=i?i/6:i; }

  if(pos(g)&&pos(i)){
    const hIR=(i*g)/405; makeRow('HOMA-IR:',hIR.toFixed(4),sHOMAIR(hIR));
    const gmmol=g/18; if(gmmol>3.5){ const hB=(20*i)/(gmmol-3.5); makeRow('HOMA-BETA (%):',hB.toFixed(4),sHOMAB(hB)); }
    const q=1/(Math.log10(i)+Math.log10(g)); makeRow('QUICKI:',q.toFixed(4),sQUICKI(q));
  }

  const G=gEls.map(val), I=iEls.map(val);
  if(G.every(pos)&&I.every(pos)&&pos(g)&&pos(i)){
    const Gm=G.reduce((a,b)=>a+b,0)/G.length, Im=I.reduce((a,b)=>a+b,0)/I.length;
    const m=10000/Math.sqrt((g*i)*(Gm*Im)); makeRow('Matsuda Index:',m.toFixed(4),sMatsuda(m));
  }

  if(enableISI.checked){
    const g0=val(gEls[0]), i0=val(iEls[0]), g120=val(gEls[4]), i120=val(iEls[4]);
    if([g0,i0,g120,i120].every(pos)){
      const isi=10000/Math.sqrt((g0*i0)*(g120*i120)); makeRow('ISI (0,120):',isi.toFixed(4),sISI(isi));
    }
  }

  if(enableAdvanced.checked){
    const g0=val(gEls[0]), i0=val(iEls[0]), g30=val(document.getElementById('g30')), i30=val(document.getElementById('i30'));
    if(pos(g0)&&pos(i0)&&pos(g30)&&pos(i30)&&g30!==g0){
      const IGI=(i30-i0)/(g30-g0); makeRow('Insulinogenic Index (IGI):',IGI.toFixed(4),{t:'—',c:''});
      let mVal=null;
      Array.from(list.children).forEach(li=>{
        if(li.textContent.includes('Matsuda Index')){
          const num=li.querySelector('.value')?.textContent;
          if(num) mVal=parseFloat(num);
        }
      });
      if(mVal!=null&&!isNaN(mVal)){
        const DI=IGI*mVal; makeRow('Disposition Index (DI):',DI.toFixed(4),{t:'—',c:''});
      }
    }
  }

  if(!list.innerHTML) list.innerHTML='<li><em>No sufficient data to compute indices yet.</em></li>';
}

/* ---------- Readiness + highlighting ---------- */
function checkReady(){
  const g=val(fg), i=val(fi);
  if(pos(g)&&pos(i)) readyText.classList.add('show'); else readyText.classList.remove('show');
}

function highlightRequired(){
  document.querySelectorAll('.form-label').forEach(l=>l.classList.remove('dot-red','dot-blue'));
  if(enableISI.checked){
    ['g0','i0','g120','i120'].forEach(id=>{
      const lbl=document.querySelector(`label[for=${id}]`);
      if(lbl) lbl.classList.add('dot-red');
    });
  }
  if(enableAdvanced.checked){
    ['g0','i0','g30','i30'].forEach(id=>{
      const lbl=document.querySelector(`label[for=${id}]`);
      if(lbl) lbl.classList.add('dot-blue');
    });
  }
}

/* ---------- Event bindings ---------- */
document.querySelectorAll('input').forEach(el=>{
  el.addEventListener('input',()=>{compute();checkReady();});
});
enableISI.addEventListener('change',()=>{highlightRequired();compute();});
enableAdvanced.addEventListener('change',()=>{highlightRequired();compute();});
document.getElementById('copyFasting').onclick=()=>{
  document.getElementById('g0').value=fg.value;
  document.getElementById('i0').value=fi.value;
  compute();checkReady();highlightRequired();
};
document.getElementById('clearOGTT').onclick=()=>{
  gEls.forEach(e=>e.value=''); iEls.forEach(e=>e.value=''); compute();highlightRequired();
};
scrollBtn.onclick=()=>document.getElementById('results').scrollIntoView({behavior:'smooth'});

/* ---------- Timestamp helper ---------- */
function indianTimestamp(){
  const d=new Date(), pad=n=>String(n).padStart(2,'0');
  return `${pad(d.getDate())}/${pad(d.getMonth()+1)}/${d.getFullYear()} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
}

/* ---------- PDF Generator ---------- */
document.getElementById('pdfBtn').addEventListener('click',()=>{
  const {jsPDF}=window.jspdf;
  const doc=new jsPDF({unit:"pt",format:"a4"});
  doc.setProperties({
    title:"Insulin Sensitivity Suite Report",
    author:"Shaurya Trivedi",
    subject:"Comprehensive insulin sensitivity and β-cell indices"
  });

  let y=60,lg=18,sg=24;
  doc.setFontSize(16); doc.text("Insulin Sensitivity Suite Report",40,y); y+=lg;
  doc.setFontSize(11); doc.text(`Generated on: ${indianTimestamp()} (IST)`,40,y); y+=sg;

  /* --- Inputs section --- */
  doc.setFontSize(13); doc.text("Input Values",40,y); y+=lg;
  doc.setFontSize(11);
  const gu=glucoseUnit.textContent.trim(), iu=insulinUnit.textContent.trim();
  if(fg.value){ doc.text(`Fasting Glucose: ${fg.value} ${gu}`,60,y); y+=lg; }
  if(fi.value){ doc.text(`Fasting Insulin: ${fi.value} ${iu}`,60,y); y+=lg; }

  const ogttLabels=[
    ["Glucose 0′","g0"],["Insulin 0′","i0"],
    ["Glucose 30′","g30"],["Insulin 30′","i30"],
    ["Glucose 60′","g60"],["Insulin 60′","i60"],
    ["Glucose 90′","g90"],["Insulin 90′","i90"],
    ["Glucose 120′","g120"],["Insulin 120′","i120"]
  ];
  ogttLabels.forEach(([lab,id])=>{
    const el=document.getElementById(id);
    if(el && el.value){
      doc.text(`${lab}: ${el.value}`,60,y);
      y+=lg; if(y>760){doc.addPage();y=60;}
    }
  });
  y+=sg;

  /* --- Results section --- */
  doc.setFontSize(13); doc.text("Calculated Results",40,y); y+=lg; doc.setFontSize(11);
  Array.from(document.querySelectorAll('#resultList li')).forEach(li=>{
    const lines=doc.splitTextToSize(li.innerText,480);
    lines.forEach(line=>{
      doc.text(line,60,y); y+=lg;
      if(y>780){doc.addPage();y=60;}
    });
  });
  y+=sg;

  /* --- Footer note --- */
  doc.setFontSize(10); doc.setTextColor(100);
  doc.text("For educational and research use only. No data stored.",40,y);

  let name=prompt("Enter filename for the report:","Insulin_Sensitivity_Suite_Report");
  if(!name||!name.trim()) name="Insulin_Sensitivity_Suite_Report";
  if(!name.toLowerCase().endsWith(".pdf")) name+=".pdf";
  doc.save(name);
});

/* ---------- Init ---------- */
compute(); checkReady(); highlightRequired();
})();
</script>
</body>
</html>
